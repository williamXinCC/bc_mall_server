<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"  xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
	<meta charset="UTF-8">
	<title>添加商品</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta http-equiv="Access-Control-Allow-Origin" content="*">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">
	<link rel="stylesheet" th:href="@{/layui/css/layui.css}" media="all" />
	<link rel="stylesheet" th:href="@{/css/public.css}" media="all" />
	<link rel="stylesheet" th:href="@{/layui_ext/dtree/dtree.css}" media="all" />
	<link rel="stylesheet" th:href="@{/layui_ext/dtree/font/dtreefont.css}" media="all" />
	<link rel="stylesheet" th:href="@{/layui_ext/step-lay/step.css}" >

</head>
<body class="childrenBody">
<div class="layui-carousel" id="stepForm" lay-filter="stepForm" style="margin: 0 auto;">
	<div carousel-item>
		<div>
			<form class="layui-form" style="margin: 0 auto;padding-top: 20px;">
				<div class="layui-form-item">
					<label class="layui-form-label">商品分类:</label>
					<div class="layui-input-inline">
						<input type="hidden" name="cId" id="cId" placeholder="请选择分类">
						<input type="hidden" name="cName" id="cName" >
						<ul id="productCategoryTree" class="dtree" data-id="0"></ul>
					</div>
					<label class="layui-form-label">商品品牌:</label>
					<input type="hidden" name="bChName" id="bChName">
					<div class="layui-input-inline">
						<select name="bId" id="bId" lay-filter="bId">
							<option >选择品牌</option>
						</select>
					</div>
					<label class="layui-form-label">商品名称:</label>
					<div class="layui-input-inline">
						<input type="text" name="name" placeholder="请填写商品名称" value="" class="layui-input" required>
					</div>
					<label class="layui-form-label">商品标题:</label>
					<div class="layui-input-inline">
						<input type="text" name="title" placeholder="请填写入商品标题" value="" class="layui-input" required>
					</div>
					<label class="layui-form-label">列表售价:</label>
					<div class="layui-input-inline">
						<input type="text" name="listPrice" placeholder="请填写入列表售价" value="" class="layui-input" required>
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">SN货号:</label>
					<div class="layui-input-inline">
						<input type="text" name="sn" placeholder="请填写SN货号" value="" class="layui-input" required>
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">列表图片:</label>
					<div class="layui-input-block">
						<input type="text" name="listImage" placeholder="请填写入列表图片" value="" class="layui-input" required>
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">原价:</label>
					<div class="layui-input-inline">
						<input type="text" name="baseValue" placeholder="请填写入原价" value="" class="layui-input" required>
					</div>
					<label class="layui-form-label">市场价:</label>
					<div class="layui-input-inline">
						<input type="text" name="marketPrice" placeholder="请填写入市场价" value="" class="layui-input" required>
					</div>
					<label class="layui-form-label">库存:</label>
					<div class="layui-input-inline">
						<input type="number" name="stock" placeholder="请填写入库存" value="" class="layui-input" required>
					</div>
					<label class="layui-form-label">库存预警:</label>
					<div class="layui-input-inline">
						<input type="number" name="lowStock" placeholder="请填写入库存预警" value="" class="layui-input" required>
					</div>
					<label class="layui-form-label">重量/公斤:</label>
					<div class="layui-input-inline">
						<input type="text" name="weight" placeholder="请填写入重量" value="" class="layui-input" required>
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">商品描述:</label>
					<div class="layui-input-block">
						<input type="text" name="describes" placeholder="请填写商品描述" value="" class="layui-input" required>
					</div>
				</div>

				<div class="layui-form-item">
					<div class="layui-input-block">
						<button class="layui-btn" lay-submit lay-filter="formStep">
							&emsp;下一步&emsp;
						</button>
					</div>
				</div>
			</form>
		</div>
		<!--   form 2 -->
		<div>
			<form class="layui-form" style="margin: 0 auto;max-width: 460px;padding-top: 40px;">
				<label class="layui-form-label">属性分类:</label>
				<div class="layui-input-inline">
					<input type="hidden" name="cId" id="cId" placeholder="请选择分类">
					<input type="hidden" name="cName" id="cName" >
					<ul id="productCategoryTree" class="dtree" data-id="0"></ul>
				</div>
				<div class="layui-form-item">
					<div class="layui-input-block">
						<button type="button" class="layui-btn layui-btn-primary pre">上一步</button>
						<button class="layui-btn" lay-submit lay-filter="formStep2">
							&emsp;下一步&emsp;
						</button>
					</div>
				</div>
			</form>
		</div>

		<!--   form 3  -->
		<div>
			<form class="layui-form" style="margin: 0 auto;padding-top: 40px;">
				<div class="layui-form-item">
					<label class="layui-form-label">赠送积分:</label>
					<div class="layui-input-inline">
						<input type="number" name="givePoint" class="layui-input">
					</div>
					<label class="layui-form-label">可使用积分:</label>
					<div class="layui-input-inline">
						<input type="number" name="usePoint" class="layui-input">
					</div>
					<label class="layui-form-label">新品:</label>
					<div class="layui-input-inline">
						<input type="radio" name="newStatus" value="1" title="是" checked="" class="layui-input">
						<input type="radio" name="newStatus" value="2" title="否" class="layui-input">
					</div>
					<label class="layui-form-label ">推荐:</label>
					<div class="layui-input-inline">
						<input type="radio" name="recommandStatus" value="1" title="是" checked="" class="layui-input">
						<input type="radio" name="recommandStatus" value="2" title="否" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">上下架:</label>
					<div class="layui-input-inline">
						<input type="radio" name="putaway" value="1" title="是" checked="" class="layui-input">
						<input type="radio" name="putaway" value="2" title="否" class="layui-input">
					</div>
					<label class="layui-form-label">服务保证:</label>
					<div class="layui-input-block">
						<input type="checkbox" name="" title="无忧退货" class="layui-input">
						<input type="checkbox" name="" title="快速退款" class="layui-input">
						<input type="checkbox" name="" title="免费包邮" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">详情标题</label>
					<div class="layui-input-inline">
					<input type="text" name="detailTitle" autocomplete="off" placeholder="详情标题" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">商品详情</label>
					<div class="layui-input-block">
						<textarea id="detailPc" name="detailPc"  placeholder="商品详情" class="layui-textarea"></textarea>
					</div>
				</div>
				<div>
					<label class="layui-form-label">促销活动:</label>
					<div class="layui-input-inline">
						<div class="layui-tab">
							<ul class="layui-tab-title">
								<li class="layui-this">无优惠</li>
								<li>特惠促销</li>
								<li>会员价格</li>
								<li>阶梯价格</li>
								<li>满减价格</li>
							</ul>
							<div class="layui-tab-content">
								<div class="layui-tab-item layui-show"></div>
								<div class="layui-tab-item">
									<div class="layui-form-item">
										<label class="layui-form-label">开始时间</label>
										<div class="layui-input-inline">
										<input type="text" name="startTime" id="startTime" autocomplete="off" placeholder="请选择开始时间" class="layui-input">
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label">结束时间</label>
										<div class="layui-input-inline">
										<input type="text" name="startTime" id="endTime" autocomplete="off" placeholder="请选择结束时间" class="layui-input">
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label">促销价格</label>
										<div class="layui-input-inline">
										<input type="text" name="promotionPrice" id="promotionPrice" autocomplete="off" placeholder="促销价格" class="layui-input">
										</div>
									</div>
								</div>
								<div class="layui-tab-item">
									<div class="layui-form-item">
										<label class="layui-form-label">黄金会员</label>
										<div class="layui-input-inline">
											<input type="text" name="goldenCard" autocomplete="off" placeholder="黄金会员价" class="layui-input">
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label">白金会员</label>
										<div class="layui-input-inline">
											<input type="text" name="platinumCard" autocomplete="off" placeholder="白金会员价" class="layui-input">
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label">钻石会员</label>
										<div class="layui-input-inline">
											<input type="text" name="diamondCard" autocomplete="off" placeholder="钻石会员价" class="layui-input">
										</div>
									</div>
								</div>
								<div class="layui-tab-item">
									<!-- 数据表格开始 -->
									<div>
										<table class="layui-hide" id="goodsTable" lay-filter="goodsTable"></table>
										<div id="goodsRowBar" style="display: none;">
											<button type="button" lay-event="add" class="layui-btn layui-btn-sm layui-btn-normal" shiro:hasPermission="product:update"><span class="layui-icon layui-icon-edit"></span>添加</button>
											<button type="button" lay-event="delete" class="layui-btn layui-btn-sm layui-btn-danger" shiro:hasPermission="product:del"><span class="layui-icon layui-icon-delete"></span>删除</button>
										</div>
									</div>
								</div>
								<div class="layui-tab-item">内容5</div>
							</div>
						</div>
					</div>
				</div>

				<!--<div>-->
					<!--<label class="layui-form-label">选择优惠方式:</label>-->
					<!--<div class="layui-input-inline">-->
					<!--</div>-->
				<!--</div>-->
				<div class="layui-form-item">
					<div class="layui-input-block">
						<button type="button" class="layui-btn layui-btn-primary pre">上一步</button>
						<button class="layui-btn" lay-submit lay-filter="formStep3">
							&emsp;确认&emsp;
						</button>
					</div>
				</div>
			</form>
		</div>
		<div>
			<div style="text-align: center;margin-top: 90px;">
				<i class="layui-icon layui-circle"
				   style="color: white;font-size:30px;font-weight:bold;background: #52C41A;padding: 20px;line-height: 80px;">&#xe605;</i>
				<div style="font-size: 24px;color: #333;font-weight: 500;margin-top: 30px;">
					添加成功
				</div>
			</div>
			<div style="text-align: center;margin-top: 50px;">
				<button class="layui-btn next">继续添加</button>
				<button class="layui-btn layui-btn-primary">跳转到商品列表</button>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript" src="/layui/layui.js"></script>
<script type="text/javascript"  src="/layui_ext/step-lay/step.js"></script>
<script type="text/javascript">
    var tableIns;
    layui.extend({
        dtree: '/layui_ext/dtree/dtree',   // {/}的意思即代表采用自有路径，即不跟随 base 路径
        tinymce: '/layui_ext/tinymce/tinymce',
		step: '/layui_ext/step-lay/step'
    }).use(['element','jquery','form','table','layer','dtree','upload','tinymce','util','layedit','step','laydate'],function(){
        var $=layui.jquery;
        var form=layui.form;
        var table=layui.table;
        var layer=layui.layer;
        var dtree=layui.dtree;
        var upload = layui.upload;
        var tinymce = layui.tinymce;
        var step = layui.step;
        var element = layui.element;
        var laydate = layui.laydate;
        var edit;


        //加载 数据
        tableIns = table.render({
            elem: '#goodsTable'
            ,url:'/william-product/getProductList'
            ,skin: 'row'
            ,cols: [ [
                 {field:'num', title:'数量',align:'center',width:'120'}
                ,{field:'discount', title:'折扣',align:'center',width:'120'}
                ,{fixed: 'right', title:'操作', toolbar: '#goodsRowBar',align:'center',width:'230'}
            ] ]
            ,done: function(res, curr, count){ //处理删除某一页最后一条数据的BUG
                if(res.data.length == 0 && curr !=1){
                    tableIns.reload({
                        page:{
                            curr:(curr-1)
                        }
                    });
                }
                // 隔行换色
//                var that = this.elem.next()
//                res.data.forEach(function (item,index) {
//                    if(index % 2 == 0){
//                        var tr = that.find(".layui-table-box tbody tr[data-index='" + index + "']").css("background-color","#caf9fb");
//                    }
//						else{
//                            var tr = that.find(".layui-table-box tbody tr[data-index='" + index + "']").css("background-color","blue");
//						}
//                })
            }
        });

        //监听单元格编辑
//        table.on('edit(roleTable)', function(obj){
//            var value = obj.value //得到修改后的值
//                ,data = obj.data //得到所在行所有键值
//                ,field = obj.field; //得到字段
//
//            var reqData ={};
//            reqData["roleId"] = data.roleId;
//            reqData[field] = value;
//            layer.confirm('请确认后修改!',function () {
//                postAsyncTrue("/william-role/updateRole",reqData);
//            });
//        });

        //监听单元格编辑
        table.on('edit(goodsTable)', function(obj){
            var value = obj.value //得到修改后的值
                ,data = obj.data //得到所在行所有键值
                ,field = obj.field; //得到字段
            layer.msg('[ID: '+ data.id +'] ' + field + ' 字段更改为：'+ value);
        });

        var now = new Date();
        // 渲染日期
        laydate.render({
            elem: '#startTime',
            type: 'datetime',
            format: 'yyyy-MM-dd HH:mm:ss',
            theme: 'molv',
            min:now.toLocaleString(),
            ready: function(date){
                //可以自定义时分秒
                this.dateTime.hours=now.getHours();
                this.dateTime.minutes=now.getMinutes();
            },
            done: function(value, date, endDate){
                setTimes = value;
                startTime.config.max = {
                    year:date.year,
                    month:date.month-1,
                    date: date.date,
                    hours:this.dateTime.hours,
                    minutes:this.dateTime.minutes
                };
                console.log('获取设置的时间',setTimes );
            }
        });
        laydate.render({
            elem: '#endTime',
            type: 'datetime',
            format: 'yyyy-MM-dd HH:mm:ss',
            theme: 'molv',
            min:now.toLocaleString(),
            ready: function(date){
                //可以自定义时分秒
                this.dateTime.hours=now.getHours();
                this.dateTime.minutes=now.getMinutes();
            },
            done: function(value, date, endDate){
                setTimes = value;
                startTime.config.max = {
                    year:date.year,
                    month:date.month-1,
                    date: date.date,
                    hours:this.dateTime.hours,
                    minutes:this.dateTime.minutes
                };
                console.log('获取设置的时间',setTimes );
            }
        });

        var mainIndex;
        var url;

        // 下拉品牌
        $(function () {
            $.ajax({
                type: "POST",
                url: "/william-brand/getAllBrand",
                datatype: "json",//“xml”, “html”, “script”, “json”, “jsonp”, “text”.
                success: function (res) {
                    console.log(res);
                    $.each(res.data, function (index, item) {
                        console.log(item);
                        $("#bId").append(new Option(item.chName, item.id));// 下拉菜单里添加元素
                    });
                    form.render("select");
                },error:function() {

                }
            });
        });

        form.on('select(bId)',function (data) {
            console.log(data.value);
            var a = data.elem[data.elem.selectedIndex].text;
            $('#bChName').val(a)
        });

        step.render({
            elem: '#stepForm',
            filter: 'stepForm',
            width: '100%', //设置容器宽度
            stepWidth: '750px',
            height: '1000px',
            stepItems: [{
                title: '填写商品信息'
            }, {
                title: '填写商品属性'
            },  {
                title: '商品促销活动'
            },
                {
                title: '完成'
            }]
        });


        form.on('submit(formStep)', function (data) {
            step.next('#stepForm');
            return false;
        });

        form.on('submit(formStep2)', function (data) {
            step.next('#stepForm');
            return false;
        });

        form.on('submit(formStep3)', function (data) {
            step.next('#stepForm');
            return false;
        });

        $('.pre').click(function () {
            step.pre('#stepForm');
        });

        $('.next').click(function () {
            step.next('#stepForm');
        });


        // 提交按钮
        form.on("submit(doSubmit)",function(data){
            // 增加属性
            $('.submit-button').attr('disabled', 'disabled');
            var content = edit.getContent();
            data.field.detailPc = content;
            $.post(url,data.field,function(res){
                if(res.code == 200){
                    $('.submit-button').removeAttr('disabled');
                    tableIns.reload({
                        where:{
                            cId:$("#cId").val()
                        }
                    });
                    //刷新下拉树
                    selectTree.reload();
                }
                layer.msg(res.msg);
                layer.close(mainIndex);
            });
            return false;
        });


        //初始化 -- 分类 --下拉树
        var selectTree = dtree.renderSelect({
            elem: "#productCategoryTree",
            width: "100%", // 可以在这里指定树的宽度来填满div
            dataStyle: "layuiStyle",  //使用layui风格的数据格式
            dataFormat: "list",  //配置data的风格为list
            response:{message:"msg",statusCode:0},  //修改response中返回数据的定义
            url: "/william-category/getCategoryLeftTreeJson" // 使用url加载（可与data加载同时存在）
        });

        //监听点击的方法
        dtree.on("node(productCategoryTree)" ,function(obj){
            // 点击当前节点传递的参数  分类id
            $("#cId").val(obj.param.nodeId);
            // 分类内容 context
            $("#cName").val(obj.param.context)
        });


    });

    // 给其它页面刷新当前页面数据表格的方法
    function reloadTable(id){
        console.log(id)
        tableIns.reload({
            where:{
                cId:id
            },
            page:{
                curr:1
            }
        });
    }




</script>

</body>
</html>